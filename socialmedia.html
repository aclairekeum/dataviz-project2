
<!DOCTYPE html>
<!--referenced http://bl.ocks.org/mbostock/3943967 for the stacked bar plot-->
<html>
  <head>
    <meta charset="utf-8">
    <title>Data Viz Project 2</title>
    <!-- load D3 library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

     <style>
         text {
            font-family: sans-serif;
         }

         .bar { 
             stroke: white;
             stroke-width: 2px;
         }

         .value {
             font-weight: bold;
             font-size: 16px;
             fill: blue;
         }

         .label {
             font-size: 20px;
         }

         .title {
             font-weight: bold;
             font-size: 20px;
             fill: black;
         }

         .axis text {
          font: 10px sans-serif;
        }

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        svg#viz {
            margin-left:50px;
            margin-right: 50px;
            /*text-align: center;*/
        }

    </style>
  </head>
  
  <body>
    
    <div class= "buttons">
      <button type="button" class="btn btn-primary" id="button_Gender">Gender</button>
      <button type="button" class="btn btn-primary"id="button_Race">Race</button>
      <button type="button" class="btn btn-primary"id="button_Education">Education</button>
      <button type="button" class="btn btn-primary"id="button_Employment">Employment</button>
      <button type="button" class="btn btn-primary"id="button_Living">Living</button>
      <button type="button" class="btn btn-primary"id="button_Income">Income</button>
      <button type="button" class="btn btn-primary"id="button_Age">Age</button>
    </div>

    <svg id="viz" height="600" width="800">
    </svg>

     

    <script>
      
window.addEventListener("load",run);

function run () {
    //initialize the template
    initializeTemplate();

    //assign the button events
    button_Gender.addEventListener("click",function() { updateCategory("Gender");});
    button_Race.addEventListener("click",function() {updateCategory("Race"); });
    button_Age.addEventListener("click",function() { updateCategory("Age"); });
    button_Education.addEventListener("click",function() {updateCategory("Education"); });
    button_Employment.addEventListener("click",function() { updateCategory("Employment"); });
    button_Living.addEventListener("click",function() { updateCategory("Living"); });
    button_Income.addEventListener("click",function() { updateCategory("Income"); });  
}

function initializeTemplate(){
    //SVG import
    var svgns = "http://www.w3.org/2000/svg";
    var svg = d3.select("#viz");

    // Sizing
    var height = svg.attr("height");
    var width = svg.attr("width");
    var margin = 50;

    //Set a default title
    var category = "";
    svg.append("text")
        .attr("class","title")
        .attr("x",width/2)
        .attr("y",margin/2)
        .attr("dy","0.3em")
        .style("text-anchor","middle")
        .text ("Comparison of " + category +" Percentage Difference across the platform");

    //Platform group creation
    var platforms = ["Facebook","Instagram","Twitter","LinkedIn","Pinterest"];
    platforms.forEach(function(platform,i){
            svg.append("g")
            .attr("class",platform);

            svg.selectAll("g")
            .append("text")
            .attr("x",margin+150*i)
            .attr("y",height-margin+30)
            .style("text-anchor","middle")
            .text(platform);

        });
    
    }

    function updateCategory(category){
        var platforms = ["Facebook","Instagram","Twitter","LinkedIn","Pinterest"];
        var svg = d3.select("#viz");
        var height = svg.attr("height");
        var width = svg.attr("width");
        var margin = 50;

        var chartHeight = height - 2*margin;
        var chartWidth = width - 2*margin;
        var barmargin = 10;

        // update the title
        svg.select(".title")
        .text ("Comparison of " + category +" Percentage Difference across the platform");
        
        //remove all the bars before appending any.
        svg.selectAll(".bar").remove();
        svg.selectAll(".label").remove();
        svg.selectAll(".legend").remove();
        //update the bar grpahs
        platforms.forEach(function(platform,i){
            updateBars(platform, category, margin, chartWidth, chartHeight, barmargin, i)
        });
    }

    function updateBars(platform, category, margin, chartWidth, chartHeight, barmargin, order){
        var svg = d3.select("#viz");
        var height = svg.attr("height")
        var thisData = getDataRows(platform, category);
        var type_len = thisData.length;
        var barWidth = (chartWidth/(5*(type_len+1)-1))-barmargin;

        //color scheme different for each type
        var color = d3.scale.linear()
        .domain([0, thisData.length - 1])
        .range(["#AB374B", "#5D37AB"]);

        ////append each data to a group within a platform
        var platformgroup = svg.selectAll(".g");
        var sel = platformgroup.data(thisData).enter().append("g");


        //append a rect for each group.
        sel.append("rect")
            .attr("class","bar")
            .attr("x",function(v,i){
                return order*(thisData.length+1)*(barmargin+barWidth)+i*(barmargin+barWidth);})
            .attr("y", height-margin)
            .attr("width",barWidth)
            .attr("height", 0)
        //give a transition event
            .transition()
            .duration(2000)
            .attr("y",function(d) {return height-margin-(chartHeight*d.value/100); })
            .attr("height",function(d) { return chartHeight*d.value/100; })
            .attr("fill",function(d,i){return color(i)});

        //add the values for each data point
         sel.append("text")
            .attr("class","label")
            .attr("x",function(v,i){
                return order*(thisData.length+1)*(barmargin+barWidth)+i*(barmargin+barWidth);})
            .attr("y", height-margin)
            .style("font-size", "12px")
            .attr("fill","white")
            .text(function(d){return d.value;})
            .transition()
            .duration(2050)
            .attr("y",function(d) {return height-margin-(chartHeight*d.value/100)+20; });

        sel.append("rect")
            .attr("class","legend")
            .attr("x", chartWidth-150)
            .attr("y", function(d,i){return chartHeight-450+20*i})
            .attr("width",15)
            .attr("height",15)
            .attr("fill", function(d,i){return color(i)});

        sel.append("rect")
            .attr("class","legend")
            .attr("x", chartWidth-150)
            .attr("y", function(d,i){return chartHeight-450+20*i})
            .attr("width",15)
            .attr("height",15)
            .attr("fill", function(d,i){return color(i)});

        sel.append("text")
            .attr("class","legend")
            .attr("x", chartWidth-130)
            .attr("y", function(d,i){return chartHeight-440+20*i})
            .style("font-size", "12px")
            .text(function(d){return d.type});
        }


/* From 
   http://www.pewinternet.org/files/2015/08/Social-Media-Update-2015-FINAL2.pdf
*/


function getDataRows (platform,category) {
    var data = [
    { platform: "Facebook", category: "Total", type: "Total", value: 72},
    { platform: "Facebook", category: "Gender", type: "Men", value: 66},
    { platform: "Facebook", category: "Gender", type: "Women", value: 77},
    { platform: "Facebook", category: "Race", type: "White, Non-Hispanic", value: 70},
    { platform: "Facebook", category: "Race", type: "Black, Non-Hispanic", value: 67},
    { platform: "Facebook", category: "Race", type: "Hispanic", value: 75},
    { platform: "Facebook", category: "Age", type: "18-29", value: 82},
    { platform: "Facebook", category: "Age", type: "30-49", value: 79},
    { platform: "Facebook", category: "Age", type: "50-64", value: 64},
    { platform: "Facebook", category: "Age", type: "65+", value: 48},
    { platform: "Facebook", category: "Education", type: "High School", value: 71},
    { platform: "Facebook", category: "Education", type: "Some College", value: 72},
    { platform: "Facebook", category: "Education", type: "College", value: 72},
    { platform: "Facebook", category: "Income", type: "Less than 30000", value: 73},
    { platform: "Facebook", category: "Income", type: "30000-49999", value: 72},
    { platform: "Facebook", category: "Income", type: "50000-74999", value: 66},
    { platform: "Facebook", category: "Income", type: "More than 75000", value: 78},
    { platform: "Facebook", category: "Living", type: "Urban", value: 74},
    { platform: "Facebook", category: "Living", type: "Suburban", value: 72},
    { platform: "Facebook", category: "Living", type: "Rural", value: 67},

    { platform: "Pinterest", category: "Total", type: "Total", value: 31},
    { platform: "Pinterest", category: "Gender", type: "Men", value: 16},
    { platform: "Pinterest", category: "Gender", type: "Women", value: 44},
    { platform: "Pinterest", category: "Race", type: "White, Non-Hispanic", value: 32},
    { platform: "Pinterest", category: "Race", type: "Black, Non-Hispanic", value: 23},
    { platform: "Pinterest", category: "Race", type: "Hispanic", value: 32},
    { platform: "Pinterest", category: "Age", type: "18-29", value: 37},
    { platform: "Pinterest", category: "Age", type: "30-49", value: 36},
    { platform: "Pinterest", category: "Age", type: "50-64", value: 24},
    { platform: "Pinterest", category: "Age", type: "65+", value: 16},
    { platform: "Pinterest", category: "Education", type: "High School", value: 25},
    { platform: "Pinterest", category: "Education", type: "Some College", value: 37},
    { platform: "Pinterest", category: "Education", type: "College", value: 31},
    { platform: "Pinterest", category: "Income", type: "Less than 30000", value: 24},
    { platform: "Pinterest", category: "Income", type: "30000-49999", value: 37},
    { platform: "Pinterest", category: "Income", type: "50000-74999", value: 41},
    { platform: "Pinterest", category: "Income", type: "More than 75000", value: 30},
    { platform: "Pinterest", category: "Living", type: "Urban", value: 26},
    { platform: "Pinterest", category: "Living", type: "Suburban", value: 34},
    { platform: "Pinterest", category: "Living", type: "Rural", value: 31},

    { platform: "Instagram", category: "Total", type: "Total", value: 28},
    { platform: "Instagram", category: "Gender", type: "Men", value: 24},
    { platform: "Instagram", category: "Gender", type: "Women", value: 31},
    { platform: "Instagram", category: "Race", type: "White, Non-Hispanic", value: 21},
    { platform: "Instagram", category: "Race", type: "Black, Non-Hispanic", value: 47},
    { platform: "Instagram", category: "Race", type: "Hispanic", value: 38},
    { platform: "Instagram", category: "Age", type: "18-29", value: 55},
    { platform: "Instagram", category: "Age", type: "30-49", value: 28},
    { platform: "Instagram", category: "Age", type: "50-64", value: 11},
    { platform: "Instagram", category: "Age", type: "65+", value:4},
    { platform: "Instagram", category: "Education", type: "High School", value: 25},
    { platform: "Instagram", category: "Education", type: "Some College", value: 32},
    { platform: "Instagram", category: "Education", type: "College", value: 26},
    { platform: "Instagram", category: "Income", type: "Less than 30000", value: 26},
    { platform: "Instagram", category: "Income", type: "30000-49999", value: 27},
    { platform: "Instagram", category: "Income", type: "50000-74999", value: 30},
    { platform: "Instagram", category: "Income", type: "More than 75000", value: 26},
    { platform: "Instagram", category: "Living", type: "Urban", value: 32},
    { platform: "Instagram", category: "Living", type: "Suburban", value: 28},
    { platform: "Instagram", category: "Living", type: "Rural", value: 18},

    { platform: "LinkedIn", category: "Total", type:"Total", value: 25},
    { platform: "LinkedIn", category: "Gender", type:"Men", value: 26},
    { platform: "LinkedIn", category: "Gender", type:"Women", value: 25},
    { platform: "LinkedIn", category: "Race", type: "White, Non-Hispanic", value: 26},
    { platform: "LinkedIn", category: "Race", type: "Black, Non-Hispanic", value: 22},
    { platform: "LinkedIn", category: "Race", type: "Hispanic", value: 22},
    { platform: "LinkedIn", category: "Age", type:"18-29", value: 22},
    { platform: "LinkedIn", category: "Age", type:"30-49", value: 32},
    { platform: "LinkedIn", category: "Age", type:"50-64", value: 26},
    { platform: "LinkedIn", category: "Age", type:"65+", value: 12},
    { platform: "LinkedIn", category: "Education", type:"High School", value: 9},
    { platform: "LinkedIn", category: "Education", type:"Some College", value: 25},
    { platform: "LinkedIn", category: "Education", type:"College", value: 46},
    { platform: "LinkedIn", category: "Income", type:"Less than 30000", value: 17},
    { platform: "LinkedIn", category: "Income", type:"30000-49999", value: 21},
    { platform: "LinkedIn", category: "Income", type:"50000-74999", value: 32},
    { platform: "LinkedIn", category: "Income", type:"More than 75000", value: 41},
    { platform: "LinkedIn", category: "Employment", type:"Employed", value: 32},
    { platform: "LinkedIn", category: "Employment", type:"Not Employed", value: 14},
    { platform: "LinkedIn", category: "Living", type:"Urban", value: 30},
    { platform: "LinkedIn", category: "Living", type:"Suburban", value: 26},
    { platform: "LinkedIn", category: "Living", type:"Rural", value: 12},

    { platform: "Twitter", category: "Total", type:"Total", value: 23},
    { platform: "Twitter", category: "Gender", type: "Men", value: 25},
    { platform: "Twitter", category: "Gender", type:"Women", value: 21},
    { platform: "Twitter", category: "Race", type: "White, Non-Hispanic", value: 20},
    { platform: "Twitter", category: "Race", type: "Black, Non-Hispanic", value: 28},
    { platform: "Twitter", category: "Race", type: "Hispanic", value: 28},
    { platform: "Twitter", category: "Age", type:"18-29", value: 32},
    { platform: "Twitter", category: "Age", type:"30-49", value: 29},
    { platform: "Twitter", category: "Age", type:"50-64", value: 13},
    { platform: "Twitter", category: "Age", type:"65+", value:6},
    { platform: "Twitter", category: "Education", type:"High School", value: 19},
    { platform: "Twitter", category: "Education", type:"Some College", value: 23},
    { platform: "Twitter", category: "Education", type:"College", value: 27},
    { platform: "Twitter", category: "Income", type:"Less than 30000", value: 21},
    { platform: "Twitter", category: "Income", type:"30000-49999", value: 19},
    { platform: "Twitter", category: "Income", type:"50000-74999", value: 25},
    { platform: "Twitter", category: "Income", type:"More than 75000", value: 26},
    { platform: "Twitter", category: "Living", type:"Urban", value: 30},
    { platform: "Twitter", category: "Living", type:"Suburban", value: 21},
    { platform: "Twitter", category: "Living", type:"Rural", value: 15}
    ];
    
    return data.filter(function(row) {
    return (row.platform===platform && row.category===category) ; });
}
      
    </script>
    
  </body>
  
</html>
